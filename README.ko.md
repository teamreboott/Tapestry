# Tapestry

[English](README.md) | ν•κµ­μ–΄

μ›Ή κ²€μƒ‰ κΈ°λ° LLM QA μ‹μ¤ν…μΌλ΅, CIKM 2025 λ°λ¨ νΈλ™μ„ μ„ν•΄ μ„¤κ³„λμ—μµλ‹λ‹¤.

---

## π€ λΉ λ¥Έ μ‹μ‘

μ΄ κ°€μ΄λ“λ” Docker λλ” Kubernetesλ¥Ό μ‚¬μ©ν•μ—¬ Tapestry μ„λΉ„μ¤λ¥Ό μ‹¤ν–‰ν•λ” λ°©λ²•μ„ μ„¤λ…ν•©λ‹λ‹¤.

### 1. μ‚¬μ „ μ”κµ¬μ‚¬ν•­: ν™κ²½ μ„¤μ •

μ„λΉ„μ¤λ¥Ό μ‹μ‘ν•κΈ° μ „μ— ν™κ²½ λ³€μλ¥Ό κµ¬μ„±ν•΄μ•Ό ν•©λ‹λ‹¤. λ¨λ“  μ„¤μ •μ€ `envs` λ””λ ‰ν† λ¦¬μ `.env` νμΌμ„ ν†µν•΄ κ΄€λ¦¬λ©λ‹λ‹¤.

1.  **μμ  μ„¤μ • λ³µμ‚¬:**  
    μ κ³µλ ν…ν”λ¦Ώμ„ λ³µμ‚¬ν•μ—¬ ν™κ²½ νμΌμ„ μƒμ„±ν•©λ‹λ‹¤.

    ```bash
    cp envs/example.env envs/.env
    ```

2.  **`.env` νμΌ νΈμ§‘:**  
    μƒλ΅ μƒμ„±λ `.env` νμΌμ„ μ—΄κ³  API ν‚¤μ™€ λ°μ΄ν„°λ² μ΄μ¤ μκ²© μ¦λ…κ³Ό κ°™μ€ ν•„μ κ°’μ„ μ…λ ¥ν•©λ‹λ‹¤.

    -   κ° λ³€μμ— λ€ν• μμ„Έν• μ„¤λ…μ€ [`envs/README.ko.md`](envs/README.ko.md) κ°€μ΄λ“λ¥Ό μ°Έμ΅°ν•μ„Έμ”.
    -   **μ¤‘μ”**: `POSTGRES_HOST` λ³€μλ” λ°°ν¬ ν™κ²½μ— λ§κ² μ¬λ°”λ¥΄κ² μ„¤μ •λμ–΄μ•Ό ν•©λ‹λ‹¤:
        -   **Docker**: `POSTGRES_HOST=postgres`
        -   **Kubernetes**: `POSTGRES_HOST=tapestry-postgres`

### 2. Dockerλ΅ μ‹¤ν–‰ν•κΈ°

λ΅μ»¬ κ°λ° λ° ν…μ¤νΈμ— κ¶μ¥λλ” λ°©λ²•μ…λ‹λ‹¤.

1.  **`.env` νμΌμ΄ μ„μ—μ„ μ„¤λ…ν• λ€λ΅ κµ¬μ„±λμ–΄ μλ”μ§€ ν™•μΈ**ν•μ„Έμ”. `POSTGRES_HOST=postgres`λ΅ μ„¤μ •λμ–΄ μμ–΄μ•Ό ν•©λ‹λ‹¤.

2.  **μ‹¤ν–‰ μ¤ν¬λ¦½νΈ μ‹¤ν–‰:**  
    μ¤ν¬λ¦½νΈλ” λ””λ ‰ν† λ¦¬ μ„¤μ •μ„ μ²λ¦¬ν•κ³  Docker Composeλ¥Ό μ‚¬μ©ν•μ—¬ λ¨λ“  μ„λΉ„μ¤λ¥Ό μ‹μ‘ν•©λ‹λ‹¤.

    ```bash
    bash scripts/run.sh
    ```
    > μ¤ν¬λ¦½νΈλ” κΈ°λ³Έμ μΌλ΅ ν”„λ΅μ νΈ λ£¨νΈμ `.env` νμΌμ„ μ‚¬μ©ν•©λ‹λ‹¤.

3.  **μ„λΉ„μ¤ μ ‘κ·Ό:**
    APIλ” `http://localhost:9012`μ—μ„ μ‚¬μ©ν•  μ μμµλ‹λ‹¤. `.env` νμΌμ `APP_PORT` λ³€μλ¥Ό ν†µν•΄ ν¬νΈλ¥Ό λ³€κ²½ν•  μ μμµλ‹λ‹¤.

### 3. Kubernetesλ΅ μ‹¤ν–‰ν•κΈ°

Kubernetes ν΄λ¬μ¤ν„°μ— λ°°ν¬ν•κΈ° μ„ν• λ°©λ²•μ…λ‹λ‹¤.

1.  **`.env` νμΌμ΄ μ„μ—μ„ μ„¤λ…ν• λ€λ΅ κµ¬μ„±λμ–΄ μλ”μ§€ ν™•μΈ**ν•μ„Έμ”. `POSTGRES_HOST=tapestry-postgres`λ΅ μ„¤μ •λμ–΄ μμ–΄μ•Ό ν•©λ‹λ‹¤. λν• `LOG_DIR`κ³Ό `POSTGRES_DATA_DIR`μ΄ Kubernetes λ…Έλ“μ— μ΅΄μ¬ν•λ” μ λ€ κ²½λ΅μΈμ§€ ν™•μΈν•μ„Έμ”.

2.  **λ°°ν¬ μ¤ν¬λ¦½νΈ μ‹¤ν–‰:**  
    μ΄ μ¤ν¬λ¦½νΈλ” μ „μ²΄ λ°°ν¬ ν”„λ΅μ„Έμ¤λ¥Ό μλ™ν™”ν•©λ‹λ‹¤.

    ```bash
    bash scripts/run_k8s.sh [K8S_IP] [SERVICE_PORT] [POSTGRES_PORT] [NODE_PORT]
    ```

    **μ¤ν¬λ¦½νΈ μΈμ:**
    -   `K8S_IP`: Kubernetes ν΄λ¬μ¤ν„°μ IP μ£Όμ† (κΈ°λ³Έκ°’: `127.0.0.1`)
    -   `SERVICE_PORT`: μ• ν”λ¦¬μΌ€μ΄μ… μ„λΉ„μ¤μ λ‚΄λ¶€ ν¬νΈ (κΈ°λ³Έκ°’: `9012`)
    -   `POSTGRES_PORT`: PostgreSQL μ„λΉ„μ¤μ ν¬νΈ (κΈ°λ³Έκ°’: `5432`)
    -   `NODE_PORT`: μ„λΉ„μ¤μ— μ ‘κ·Όν•κΈ° μ„ν• μ™Έλ¶€ ν¬νΈ (κΈ°λ³Έκ°’: `30800`)

    **μμ‹:**
    ```bash
    bash scripts/run_k8s.sh 127.0.0.1 9012 5432 30800
    ```

3.  **μ„λΉ„μ¤ μ ‘κ·Ό:**
    APIλ” `http://[K8S_IP]:[NODE_PORT]`μ—μ„ μ‚¬μ©ν•  μ μμµλ‹λ‹¤ (μ: `http://127.0.0.1:30800`).

---

## π§ μ„λΉ„μ¤ ν…μ¤νΈ

μ κ³µλ ν΄λΌμ΄μ–ΈνΈ μ¤ν¬λ¦½νΈλ¥Ό μ‚¬μ©ν•μ—¬ μ¤νΈλ¦¬λ° APIλ¥Ό ν…μ¤νΈν•  μ μμµλ‹λ‹¤.

1.  **μ„λΉ„μ¤ λ””λ ‰ν† λ¦¬λ΅ μ΄λ™:**
    ```bash
    cd service/
    ```

2.  **ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰:**
    ```bash
    python client_stream.py
    ```

3.  **μ—”λ“ν¬μΈνΈ κµ¬μ„±:**  
    μ‹¤ν–‰ν•κΈ° μ „μ— `service/client_stream.py`λ¥Ό μ—΄κ³  `SERVER_URL` λ³€μκ°€ ν™κ²½μ— λ§λ” μ¬λ°”λ¥Έ μ—”λ“ν¬μΈνΈλ¥Ό κ°€λ¦¬ν‚¤λ”μ§€ ν™•μΈν•μ„Έμ”:
    -   **Docker:** `http://127.0.0.1:9012/websearch`
    -   **Kubernetes:** `http://127.0.0.1:30800/websearch` (λλ” `K8S_IP`μ™€ `NODE_PORT`)

---

## API μ—”λ“ν¬μΈνΈ

- `GET /health`: ν—¬μ¤ μ²΄ν¬ μ—”λ“ν¬μΈνΈ
- `POST /websearch`: μ¤νΈλ¦¬λ° μ‘λ‹µμ΄ μλ” λ©”μΈ QA μ—”λ“ν¬μΈνΈ

---

## ν”„λ΅μ νΈ κµ¬μ΅°

```
.
β”β”€β”€ main.py                # λ©”μΈ FastAPI μ„λ²„
β”β”€β”€ src/                   # ν•µμ‹¬ μ†μ¤ μ½”λ“ (λ¨λΈ, κ²€μƒ‰, DB, μ ν‹Έλ¦¬ν‹° λ“±)
β”β”€β”€ service/               # μ„λΉ„μ¤ λ μ΄μ–΄
β”β”€β”€ configs/               # μ„¤μ • νμΌ
β”β”€β”€ scripts/               # μλ™ν™” μ¤ν¬λ¦½νΈ (run.sh, run_k8s.sh)
β”β”€β”€ envs/                  # ν™κ²½ λ³€μ μμ  λ° λ¬Έμ„
β”β”€β”€ k8s/                   # Kubernetes λ§¤λ‹νμ¤νΈ
β”β”€β”€ requirements.txt       # Python μμ΅΄μ„±
β”β”€β”€ Dockerfile             # Docker λΉλ“ νμΌ
β”β”€β”€ docker-compose.yaml    # Docker Compose νμΌ
β””β”€β”€ README.md
``` 